<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>horses</title>
	</head>
	<body>
		<div id="user-board">
			<h3>user board</h3>
			<p>server access: <span id="user-connection">not connected</span></p>
			<div id="user-login-message" style="color: #FF0000"></div>
			<p><label for="user-name-input">login: </label><input type="text" id="user-name-input" name="user-name-input" size="10" value="mylogin" /><span id="user-name-value" style="visibility: hidden">no login</span></p>
			<p>session code: <span id="user-session-code">no session</span>
			<p id="user-pass"><label for="user-pass-input">pass: <input type="password" id="user-pass-input" name="user-pass-input" size="10" value="123" /></p>
			<p><input id="user-login-button" type="button" onclick="tryLogin();" value="login" /></p>
		</div>
		<div id="game-board">
			<h3>game board</h3>
		</div>
		
		<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"></script>
		<script>
			//SOCKET IO
			// init
			console.log("socket connecting");
			var socket = io.connect('http://localhost:4040');
			//gestion des messages
			socket.on('connection-status', function(message){
				console.log("socket#message message="+ message.content);
				document.getElementById("user-connection").innerHTML = "connected";
			});
			socket.on('game', function(game){
				console.log("game from server: "+ game.id);
				//for (var key in game){
				//	console.log("game data: key="+key+" value="+game[key]);
				//}
			});

			var currentLogin = "";
			var currentSessionCode = -1;
			
			var tryLogin = function(){
				// récupération du nom utilisateur
				var userName = document.getElementById("user-name-input").value;
				var userPass = document.getElementById("user-pass-input").value;
				console.log("tryLogin playerName="+userName);
				// appel serveur
				socket.emit('user-login',userName,userPass,function(success,message,sessionCode){
					console.log("socket#tryLogin server response: success="+success+" message="+message);
					if (success){
						currentLogin = userName;
						currentSessionCode = +(sessionCode);
						// gestion succes
						//clean messages
						document.getElementById("user-login-message").innerHTML = ' ';
						//diplay validated login and session
						document.getElementById("user-name-input").style.display = 'none';
						document.getElementById("user-name-value").innerHTML = currentLogin;
						document.getElementById("user-name-value").style.visibility = 'visible';
						document.getElementById("user-session-code").innerHTML = currentSessionCode;
						//hide login stuff
						document.getElementById("user-pass").style.display = 'none';
						document.getElementById("user-login-button").style.display = 'none';

					}else{
					// TODO gestion echec
						document.getElementById("user-login-message").innerHTML = ' '+message;
						console.log("erreur d'authent");
					}
				});
			};
		</script>
		</body>
</html>