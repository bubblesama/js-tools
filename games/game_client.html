<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>horses</title>
	</head>
	<body>
		<div id="user-board">
			<h3>user board</h3>
			<p>server access: <span id="user-connection">not connected</span></p>
			<p><label for="user-name">login: </label><input type="text" id="user-name-input" name="user-name-input" size="10" value="mylogin" /><span id="user-name-value" style="visibility: hidden">no login</span></p>
			<p id="user-pass">pass: <input type="password" id="user-pass-input" name="user-pass-input" size="10" value="123" /></p>
			<input id="user-login-button" type="button" onclick="tryLogin();" value="login" />
		</div>
		
		<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"></script>
		<script>
			//SOCKET IO
			// init
			console.log("socket connecting");
			var socket = io.connect('http://localhost:4040');
			//gestion des messages
			socket.on('connection-status', function(message){
				console.log("socket#message message="+ message.content);
				document.getElementById("user-connection").innerHTML = "connected";
			});
			socket.on('game', function(game){
				console.log("game from server: "+ game.id);
				//for (var key in game){
				//	console.log("game data: key="+key+" value="+game[key]);
				//}
			});

			var tryLogin = function(){
				// récupération du nom utilisateur
				var userName = document.getElementById("user-name-input").value;
				var userPass = document.getElementById("user-pass-input").value;
				console.log("tryLogin playerName="+userName);
				// appel serveur
				socket.emit('user-login',userName,userPass,function(success,message){
					console.log("socket#tryLogin server response: success="+success+" message="+message);
					if (success){
						//TODO gestion succes
						document.getElementById("user-pass").style.display = 'none';
						document.getElementById("user-name-input").style.display = 'none';
						document.getElementById("user-name-value").innerHTML = userName;
						document.getElementById("user-name-value").style.visibility = 'visible';
						document.getElementById("user-login-button").style.visibility = 'hidden';
					}else{
					// TODO gestion echec
						console.log("erreur d'authent");
						
						
						
					}
				});
			};
		</script>
		</body>
</html>