<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>horses</title>
	</head>
	<body>
		<div>
			<h3>server access</h3>
			<p>status: <span id="user-connection">not connected</span></p>
		<div id="user-board">
			<h3>user board</h3>
			<p><label for="user-name">login: </label><input type="text" id="user-name" name="user-name" size="10" value="mylogin" /></p>
			<p>secret number: <span id="user-secret">no secret</span></p>
			<p><input id="button-login" type="button" onclick="tryLogin();" value="login" /></p>
		</div>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"></script>
		<script>
			//SOCKET IO
			// init
			console.log("socket connecting");
			var socket = io.connect('http://localhost:4040');
			//gestion des messages
			socket.on('message', function(message){
				console.log("socket#message message="+ message.content);
				document.getElementById("user-connection").innerHTML = "connected";
			});
			socket.on('game', function(game){
				console.log("game from server: "+ game.id);
				//for (var key in game){
				//	console.log("game data: key="+key+" value="+game[key]);
				//}
			});

			var tryLogin = function(){
				// récupération du nom utilisateur
				var playerName = document.getElementById("user-name").value;
				console.log("tryLogin playerName="+playerName);
				// appel serveur
				socket.emit('login',playerName,function(success,secretCode){
					console.log("socket#tryLogin server response: success="+success+" secretCode="+secretCode);
					// TODO gestion succes
					//console.log("socket#tryLogin initial user-secret="+document.getElementById("user-secret").innerHTML);
					document.getElementById("user-secret").innerHTML = secretCode;
					document.getElementById("user-name").disabled = true;
					document.getElementById("button-login").style.diplay = 'none';
					 // TODO gestion echec
				});
			};
		</script>
		</body>
</html>