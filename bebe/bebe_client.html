<!doctype html>
<html lang="fr">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<title>bébé</title>
		<!-- style CSS embarqué
			TODO: style compatible mobile
		-->
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	</head>
	<body onload="babyStartup();">
		<div id="app" class="container">
			<h1>bébé</h1>
			<!-- zone d'affichage des warnings et autres-->
			<div id="warnings"></div>
			<!--TODO: gestion du statut de connexion au serveur-->
			<div id="status">
				<h2>statut</h2>
				<div id="connection">connexion: <span id="connection-status">?</span></div>
			</div>
				<div id="navigation">
					<!--TODO: boutons de navigation: jours avant/apres pour commencer-->
					<div id="navigation">
						<h2 id="navigation-title">navigation</h2>
						<div id="navigation-buttons" class="btn-group" role="group" aria-label="Navigation buttons">
							<button type="button" class="btn btn-outline-secondary" >avant</button>
							<button type="button" class="btn btn-outline-secondary" >après</button>
							<button type="button" class="btn btn-outline-secondary" >maintenant</button>
						</div>
					</div>
				</div>
				<!--TODO: les actions disponible-->
				<div id="actions">
					<h2 id="actions-list-title">actions</h2>
					<div id="actions-buttons" class="btn-group" role="group" aria-label="Actions buttons">
						<button type="button" class="btn btn-danger" onclick="addActivityNow('boire');">boire</button>
						<button type="button" class="btn btn-success" onclick="addActivityNow('couche');">couche</button>
						<button type="button" class="btn btn-secondary" onclick="addActivityNow('dodo');">dodo</button>
						<button type="button" class="btn btn-primary" onclick="addActivityNow('bain');">bain</button>
					</div>
				</div>
				<div id="log" >
					<h2 id="log-title">activités de la journée du <span id="log-title-day">?</span></h2>
					<p id="log-refresh-action"><input type="button" value="maj" onclick="showBabyLogForToday();"></p>
					<ul id="log-activities">
					<!--TODO: affichage des activites de la journée-->
					<!--TODO: exemple statique-->
					</ul>
				</div>
			</div>
		</div>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"></script>
		<script>
			//SOCKET IO
			// init
			console.log("#init connecting on socket");
			var currentDate = "?";


			//NOTE  var socket = io('https://lpr01.ddns.net/',{path: '/cyberscribe/socket.io'});
			var socket = io('http://localhost:6080/');
			//gestion des messages
			socket.on('connection-status', function(message){
				console.log("socket#connection-status message="+ message.content);
				document.getElementById("connection-status").innerHTML = "OK";
			});

			function changeDate(newDate){
				currentDate = newDate;
				//TODO: warning du traitement de la demande
				//TODO: blocage des activites de rafraichissement
				//TODO: appel serveur pour obtenir les activites de ce jour-là
				//TODO: puis affichage (date, activités, boutons)
				document.getElementById("log-title-day").innerHTML = currentDate;
			};

			function refreshActivitiesView(activities){
				//TODO: clean et reaffichage des valeurs d'activites
				var activitiesHtml = "";
				for (var i=0; i<activities.length; i++){
					activitiesHtml += "<li>"+activities[i].start+": "+activities[i].type+"</li>";
				}
				document.getElementById("log-activities").innerHTML = activitiesHtml;
			};

			/**
			 * Appel back pour recupérer la date et les activités
			 * Si la currentDate n'ets pas definie, recuperation de celle cote serveur
			 * */
			function showBabyLogForToday(){
				showBabyLogForDate("?");
			}

			function showBabyLogForDate(date){
				socket.emit(
					"log-get",
					date,
					function(status, date, activities){
						console.log("showBabyLogForDate return from socket; status="+status+" date="+date+" activities="+activities.length);
						changeDate(date);
						refreshActivitiesView(activities);
					}
				);
			}

			function addActivityNow(type, infos){
				addActivityNow(type,"");
			};

			function addActivityNow(type, infos){
				console.log("addActivityNow IN: type="+type);
				//TODO: ajout d'une activite immediate
				socket.emit(
					"activity-put",
					"20190811",
					type,
					function(status){
						if (status != OK){
							//TODO: affichage d'un warning
						}else{
							//TODO: refresh des activités du jour
						}
					}
				);
			};

			function babyStartup(){
				console.log("#babyStartup IN");
				//changeDate("20180812");
				showBabyLogForToday();
			}

			function appendWarning(warning){
				//TODO: affichage des warnings
			};
		</script>
		<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
	</body>
</html>